"use strict";(()=>{var e={};e.id=11,e.ids=[11],e.modules={3524:e=>{e.exports=require("@prisma/client")},7096:e=>{e.exports=require("bcrypt")},8982:e=>{e.exports=require("cookies-next")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},1564:e=>{e.exports=require("validator")},9369:e=>{e.exports=import("jose")},6249:(e,t)=>{Object.defineProperty(t,"l",{enumerable:!0,get:function(){return function e(t,i){return i in t?t[i]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,i)):"function"==typeof t&&"default"===i?t:void 0}}})},4420:(e,t,i)=>{i.a(e,async(e,a)=>{try{i.r(t),i.d(t,{config:()=>d,default:()=>l,routeModule:()=>m});var r=i(1802),n=i(7153),s=i(6249),o=i(3127),u=e([o]);o=(u.then?(await u)():u)[0];let l=(0,s.l)(o,"default"),d=(0,s.l)(o,"config"),m=new r.PagesAPIRouteModule({definition:{kind:n.x.PAGES_API,page:"/api/auth/signup",pathname:"/api/auth/signup",bundlePath:"",filename:""},userland:o});a()}catch(e){a(e)}})},3127:(e,t,i)=>{i.a(e,async(e,a)=>{try{i.r(t),i.d(t,{default:()=>c});var r=i(1564),n=i.n(r),s=i(3524),o=i(7096),u=i.n(o),l=i(9369),d=i(8982),m=e([l]);l=(m.then?(await m)():m)[0];let p=new s.PrismaClient;async function c(e,t){if("POST"===e.method){let{firstName:i,lastName:a,email:r,phone:s,city:o,password:m}=e.body,c=[];if([{valid:n().isLength(i,{min:1,max:20}),errorMessage:"First name is invalid"},{valid:n().isLength(a,{min:1,max:20}),errorMessage:"Last name is invalid"},{valid:n().isEmail(r),errorMessage:"Email is invalid"},{valid:n().isMobilePhone(s),errorMessage:"Phone number is invalid"},{valid:n().isLength(o,{min:1}),errorMessage:"City is invalid"},{valid:n().isStrongPassword(m),errorMessage:"Password is not strong enough"}].forEach(e=>{e.valid||c.push(e.errorMessage)}),c.length)return t.status(400).json({errorMessage:c[0]});if(await p.user.findUnique({where:{email:r}}))return t.status(400).json({errorMessage:"Email is associated with another account"});let P=await u().hash(m,10),g=await p.user.create({data:{first_name:i,last_name:a,email:r,phone:s,city:o,password:P}}),h=new TextEncoder().encode(process.env.JWT_SECRET),f=await new l.SignJWT({email:g.email}).setProtectedHeader({alg:"HS256"}).setExpirationTime("24h").sign(h);return(0,d.setCookie)("jwt",f,{req:e,res:t,maxAge:8640}),t.status(200).json({firstName:g.first_name,lastName:g.last_name,email:g.email,phone:g.phone,city:g.city})}return t.status(404).json("Unknown endpoint")}a()}catch(e){a(e)}})},7153:(e,t)=>{var i;Object.defineProperty(t,"x",{enumerable:!0,get:function(){return i}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(i||(i={}))},1802:(e,t,i)=>{e.exports=i(145)}};var t=require("../../../webpack-api-runtime.js");t.C(e);var i=t(t.s=4420);module.exports=i})();