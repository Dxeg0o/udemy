"use strict";(()=>{var e={};e.id=11,e.ids=[11],e.modules={53524:e=>{e.exports=require("@prisma/client")},67096:e=>{e.exports=require("bcrypt")},48982:e=>{e.exports=require("cookies-next")},41567:e=>{e.exports=require("jose")},20145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},71564:e=>{e.exports=require("validator")},21721:(e,a,i)=>{i.r(a),i.d(a,{config:()=>v,default:()=>h,routeModule:()=>w});var r={};i.r(r),i.d(r,{default:()=>handler});var s=i(71802),t=i(47153),n=i(56249),o=i(71564),l=i.n(o),d=i(53524),u=i(67096),m=i.n(u),p=i(41567),g=i(48982);let c=new d.PrismaClient;async function handler(e,a){if("POST"===e.method){let{firstName:i,lastName:r,email:s,phone:t,city:n,password:o}=e.body,d=[],u=[{valid:l().isLength(i,{min:1,max:20}),errorMessage:"First name is invalid"},{valid:l().isLength(r,{min:1,max:20}),errorMessage:"Last name is invalid"},{valid:l().isEmail(s),errorMessage:"Email is invalid"},{valid:l().isMobilePhone(t),errorMessage:"Phone number is invalid"},{valid:l().isLength(n,{min:1}),errorMessage:"City is invalid"},{valid:l().isStrongPassword(o),errorMessage:"Password is not strong enough"}];if(u.forEach(e=>{e.valid||d.push(e.errorMessage)}),d.length)return a.status(400).json({errorMessage:d[0]});let h=await c.user.findUnique({where:{email:s}});if(h)return a.status(400).json({errorMessage:"Email is associated with another account"});let v=await m().hash(o,10),w=await c.user.create({data:{first_name:i,last_name:r,email:s,phone:t,city:n,password:v}}),x=new TextEncoder().encode(process.env.JWT_SECRET),f=await new p.SignJWT({email:w.email}).setProtectedHeader({alg:"HS256"}).setExpirationTime("24h").sign(x);return(0,g.setCookie)("jwt",f,{req:e,res:a,maxAge:8640}),a.status(200).json({firstName:w.first_name,lastName:w.last_name,email:w.email,phone:w.phone,city:w.city})}return a.status(404).json("Unknown endpoint")}let h=(0,n.l)(r,"default"),v=(0,n.l)(r,"config"),w=new s.PagesAPIRouteModule({definition:{kind:t.x.PAGES_API,page:"/api/auth/signup",pathname:"/api/auth/signup",bundlePath:"",filename:""},userland:r})}};var a=require("../../../webpack-api-runtime.js");a.C(e);var __webpack_exec__=e=>a(a.s=e),i=a.X(0,[222],()=>__webpack_exec__(21721));module.exports=i})();