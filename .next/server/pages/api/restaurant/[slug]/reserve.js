"use strict";(()=>{var e={};e.id=510,e.ids=[510],e.modules={3524:e=>{e.exports=require("@prisma/client")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},6249:(e,i)=>{Object.defineProperty(i,"l",{enumerable:!0,get:function(){return function e(i,Z){return Z in i?i[Z]:"then"in i&&"function"==typeof i.then?i.then(i=>e(i,Z)):"function"==typeof i&&"default"===Z?i:void 0}}})},2084:(e,i,Z)=>{Z.r(i),Z.d(i,{config:()=>o,default:()=>d,routeModule:()=>p});var s={};Z.r(s),Z.d(s,{default:()=>l});var a=Z(1802),t=Z(7153),m=Z(6249),r=Z(3524),n=Z(2520);let T=new r.PrismaClient;async function l(e,i){if("POST"===e.method){let{slug:Z,day:s,time:a,partySize:t}=e.query,{bookerEmail:m,bookerPhone:r,bookerFirstName:l,bookerLastName:d,bookerOccsaion:o,bookerRequest:p}=e.body,c=await T.restaurant.findUnique({where:{slug:Z},select:{tables:!0,open_time:!0,close_time:!0,id:!0}});if(!c)return i.status(400).json({errorMessage:"Restaurant not found"});if(new Date(`${s}T${a}`)<new Date(`${s}T${c.open_time}`)||new Date(`${s}T${a}`)>new Date(`${s}T${c.close_time}`))return i.status(400).json({errorMessage:"Restaurant is not open at that time"});let h=await (0,n.n)({day:s,time:a,res:i,restaurant:c});if(!h)return i.status(400).json({errorMessage:"Invalid data provided"});let u=h.find(e=>e.date.toISOString()===new Date(`${s}T${a}`).toISOString());if(!u)return i.status(400).json({errorMessage:"No availability, cannot book"});let y={2:[],4:[]};u.tables.forEach(e=>{2===e.seats?y[2].push(e.id):y[4].push(e.id)});let M=[],P=parseInt(t);for(;P>0;)P>=3?y[4].length?(M.push(y[4][0]),y[4].shift(),P-=4):(M.push(y[2][0]),y[2].shift(),P-=2):y[2].length?(M.push(y[2][0]),y[2].shift(),P-=2):(M.push(y[4][0]),y[4].shift(),P-=4);let f=await T.booking.create({data:{number_of_people:parseInt(t),booking_time:new Date(`${s}T${a}`),booker_email:m,booker_phone:r,booker_first_name:l,booker_last_name:d,booker_occasion:o,booker_request:p,restaurant_id:c.id}}),A=M.map(e=>({table_id:e,booking_id:f.id}));return await T.bookingsOnTables.createMany({data:A}),i.json(f)}}let d=(0,m.l)(s,"default"),o=(0,m.l)(s,"config"),p=new a.PagesAPIRouteModule({definition:{kind:t.x.PAGES_API,page:"/api/restaurant/[slug]/reserve",pathname:"/api/restaurant/[slug]/reserve",bundlePath:"",filename:""},userland:s})},2520:(e,i,Z)=>{Z.d(i,{n:()=>m});var s=Z(3524);let a=[{displayTime:"12:00 AM",time:"00:00:00.000Z",searchTimes:["00:00:00.000Z","00:30:00.000Z","01:00:00.000Z"]},{displayTime:"12:30 AM",time:"00:30:00.000Z",searchTimes:["00:00:00.000Z","00:30:00.000Z","01:00:00.000Z","01:30:00.000Z"]},{displayTime:"1:00 AM",time:"01:00:00.000Z",searchTimes:["00:00:00.000Z","00:30:00.000Z","01:00:00.000Z","01:30:00.000Z","02:00:00.000Z"]},{displayTime:"1:30 AM",time:"01:30:00.000Z",searchTimes:["00:30:00.000Z","01:00:00.000Z","01:30:00.000Z","02:00:00.000Z","02:30:00.000Z"]},{displayTime:"2:00 AM",time:"02:00:00.000Z",searchTimes:["01:00:00.000Z","01:30:00.000Z","02:00:00.000Z","02:30:00.000Z","03:00:00.000Z"]},{displayTime:"2:30 AM",time:"02:30:00.000Z",searchTimes:["01:30:00.000Z","02:00:00.000Z","02:30:00.000Z","03:00:00.000Z","03:30:00.000Z"]},{displayTime:"3:00 AM",time:"03:00:00.000Z",searchTimes:["02:00:00.000Z","02:30:00.000Z","03:00:00.000Z","03:30:00.000Z","04:00:00.000Z"]},{displayTime:"3:30 AM",time:"03:30:00.000Z",searchTimes:["02:30:00.000Z","03:00:00.000Z","03:30:00.000Z","04:00:00.000Z","04:30:00.000Z"]},{displayTime:"4:00 AM",time:"04:00:00.000Z",searchTimes:["03:00:00.000Z","03:30:00.000Z","04:00:00.000Z","04:30:00.000Z","05:00:00.000Z"]},{displayTime:"4:30 AM",time:"04:30:00.000Z",searchTimes:["03:30:00.000Z","04:00:00.000Z","04:30:00.000Z","05:00:00.000Z","05:30:00.000Z"]},{displayTime:"5:00 AM",time:"05:00:00.000Z",searchTimes:["04:00:00.000Z","04:30:00.000Z","05:00:00.000Z","05:30:00.000Z","06:00:00.000Z"]},{displayTime:"5:30 AM",time:"05:30:00.000Z",searchTimes:["04:30:00.000Z","05:00:00.000Z","05:30:00.000Z","06:00:00.000Z","06:30:00.000Z"]},{displayTime:"6:00 AM",time:"06:00:00.000Z",searchTimes:["05:00:00.000Z","05:30:00.000Z","06:00:00.000Z","06:30:00.000Z","07:00:00.000Z"]},{displayTime:"6:30 AM",time:"06:30:00.000Z",searchTimes:["05:30:00.000Z","06:00:00.000Z","06:30:00.000Z","07:00:00.000Z","07:30:00.000Z"]},{displayTime:"7:00 AM",time:"07:00:00.000Z",searchTimes:["06:00:00.000Z","06:30:00.000Z","07:00:00.000Z","07:30:00.000Z","08:00:00.000Z"]},{displayTime:"7:30 AM",time:"07:30:00.000Z",searchTimes:["06:30:00.000Z","07:00:00.000Z","07:30:00.000Z","08:00:00.000Z","08:30:00.000Z"]},{displayTime:"8:00 AM",time:"08:00:00.000Z",searchTimes:["07:00:00.000Z","07:30:00.000Z","08:00:00.000Z","08:30:00.000Z","09:00:00.000Z"]},{displayTime:"8:30 AM",time:"08:30:00.000Z",searchTimes:["07:30:00.000Z","08:00:00.000Z","08:30:00.000Z","09:00:00.000Z","09:30:00.000Z"]},{displayTime:"9:00 AM",time:"09:00:00.000Z",searchTimes:["08:00:00.000Z","08:30:00.000Z","09:00:00.000Z","09:30:00.000Z","10:00:00.000Z"]},{displayTime:"9:30 AM",time:"09:30:00.000Z",searchTimes:["08:30:00.000Z","09:00:00.000Z","09:30:00.000Z","10:00:00.000Z","10:30:00.000Z"]},{displayTime:"10:00 AM",time:"10:00:00.000Z",searchTimes:["09:00:00.000Z","09:30:00.000Z","10:00:00.000Z","10:30:00.000Z","11:00:00.000Z"]},{displayTime:"10:30 AM",time:"10:30:00.000Z",searchTimes:["09:30:00.000Z","10:00:00.000Z","10:30:00.000Z","11:00:00.000Z","11:30:00.000Z"]},{displayTime:"11:00 AM",time:"11:00:00.000Z",searchTimes:["10:00:00.000Z","10:30:00.000Z","11:00:00.000Z","11:30:00.000Z","12:00:00.000Z"]},{displayTime:"11:30 AM",time:"11:30:00.000Z",searchTimes:["10:30:00.000Z","11:00:00.000Z","11:30:00.000Z","12:00:00.000Z","12:30:00.000Z"]},{displayTime:"12:00 PM",time:"12:00:00.000Z",searchTimes:["11:00:00.000Z","11:30:00.000Z","12:00:00.000Z","12:30:00.000Z","13:00:00.000Z"]},{displayTime:"12:30 PM",time:"12:30:00.000Z",searchTimes:["11:30:00.000Z","12:00:00.000Z","12:30:00.000Z","13:00:00.000Z","13:30:00.000Z"]},{displayTime:"1:00 PM",time:"13:00:00.000Z",searchTimes:["12:00:00.000Z","12:30:00.000Z","13:00:00.000Z","13:30:00.000Z","14:00:00.000Z"]},{displayTime:"1:30 PM",time:"13:30:00.000Z",searchTimes:["12:30:00.000Z","13:00:00.000Z","13:30:00.000Z","14:00:00.000Z","14:30:00.000Z"]},{displayTime:"2:00 PM",time:"14:00:00.000Z",searchTimes:["13:00:00.000Z","13:30:00.000Z","14:00:00.000Z","14:30:00.000Z","15:00:00.000Z"]},{displayTime:"2:30 PM",time:"14:30:00.000Z",searchTimes:["13:30:00.000Z","14:00:00.000Z","14:30:00.000Z","15:00:00.000Z","15:30:00.000Z"]},{displayTime:"3:00 PM",time:"15:00:00.000Z",searchTimes:["14:00:00.000Z","14:30:00.000Z","15:00:00.000Z","15:30:00.000Z","16:00:00.000Z"]},{displayTime:"3:30 PM",time:"15:30:00.000Z",searchTimes:["14:30:00.000Z","15:00:00.000Z","15:30:00.000Z","16:00:00.000Z","16:30:00.000Z"]},{displayTime:"4:00 PM",time:"16:00:00.000Z",searchTimes:["15:00:00.000Z","15:30:00.000Z","16:00:00.000Z","16:30:00.000Z","17:00:00.000Z"]},{displayTime:"4:30 PM",time:"16:30:00.000Z",searchTimes:["15:30:00.000Z","16:00:00.000Z","16:30:00.000Z","17:00:00.000Z","17:30:00.000Z"]},{displayTime:"5:00 PM",time:"17:00:00.000Z",searchTimes:["16:00:00.000Z","16:30:00.000Z","17:00:00.000Z","17:30:00.000Z","18:00:00.000Z"]},{displayTime:"5:30 PM",time:"17:30:00.000Z",searchTimes:["16:30:00.000Z","17:00:00.000Z","17:30:00.000Z","18:00:00.000Z","18:30:00.000Z"]},{displayTime:"6:00 PM",time:"18:00:00.000Z",searchTimes:["17:00:00.000Z","17:30:00.000Z","18:00:00.000Z","18:30:00.000Z","19:00:00.000Z"]},{displayTime:"6:30 PM",time:"18:30:00.000Z",searchTimes:["17:30:00.000Z","18:00:00.000Z","18:30:00.000Z","19:00:00.000Z","19:30:00.000Z"]},{displayTime:"7:00 PM",time:"19:00:00.000Z",searchTimes:["18:00:00.000Z","18:30:00.000Z","19:00:00.000Z","19:30:00.000Z","20:00:00.000Z"]},{displayTime:"7:30 PM",time:"19:30:00.000Z",searchTimes:["18:30:00.000Z","19:00:00.000Z","19:30:00.000Z","20:00:00.000Z","20:30:00.000Z"]},{displayTime:"8:00 PM",time:"20:00:00.000Z",searchTimes:["19:00:00.000Z","19:30:00.000Z","20:00:00.000Z","20:30:00.000Z","21:00:00.000Z"]},{displayTime:"8:30 PM",time:"20:30:00.000Z",searchTimes:["19:30:00.000Z","20:00:00.000Z","20:30:00.000Z","21:00:00.000Z","21:30:00.000Z"]},{displayTime:"9:00 PM",time:"21:00:00.000Z",searchTimes:["20:00:00.000Z","20:30:00.000Z","21:00:00.000Z","21:30:00.000Z","22:00:00.000Z"]},{displayTime:"9:30 PM",time:"21:30:00.000Z",searchTimes:["20:30:00.000Z","21:00:00.000Z","21:30:00.000Z","22:00:00.000Z","22:30:00.000Z"]},{displayTime:"10:00 PM",time:"22:00:00.000Z",searchTimes:["21:00:00.000Z","21:30:00.000Z","22:00:00.000Z","22:30:00.000Z","23:00:00.000Z"]},{displayTime:"10:30 PM",time:"22:30:00.000Z",searchTimes:["21:30:00.000Z","22:00:00.000Z","22:30:00.000Z","23:00:00.000Z","23:30:00.000Z"]},{displayTime:"11:00 PM",time:"23:00:00.000Z",searchTimes:["22:00:00.000Z","22:30:00.000Z","23:00:00.000Z","23:30:00.000Z"]},{displayTime:"11:30 PM",time:"23:30:00.000Z",searchTimes:["22:30:00.000Z","23:00:00.000Z","23:30:00.000Z"]}],t=new s.PrismaClient,m=async({time:e,day:i,res:Z,restaurant:s})=>{let m=a.find(i=>i.time===e)?.searchTimes;if(!m)return Z.status(400).json({errorMessage:"Invalid data provided"});let r=await t.booking.findMany({where:{booking_time:{gte:new Date(`${i}T${m[0]}`),lte:new Date(`${i}T${m[m.length-1]}`)}},select:{number_of_people:!0,booking_time:!0,tables:!0}}),n={};r.forEach(e=>{n[e.booking_time.toISOString()]=e.tables.reduce((e,i)=>({...e,[i.table_id]:!0}),{})});let T=s.tables,l=m.map(e=>({date:new Date(`${i}T${e}`),time:e,tables:T}));return l.forEach(e=>{e.tables=e.tables.filter(i=>!n[e.date.toISOString()]||!n[e.date.toISOString()][i.id])}),l}},7153:(e,i)=>{var Z;Object.defineProperty(i,"x",{enumerable:!0,get:function(){return Z}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(Z||(Z={}))},1802:(e,i,Z)=>{e.exports=Z(145)}};var i=require("../../../../webpack-api-runtime.js");i.C(e);var Z=i(i.s=2084);module.exports=Z})();